# Техническое решение для платформы огневого управления (Arma Reforger)

## 1) Язык и общая архитектура

**Рекомендуемый стек:**
- **Backend / баллистическое ядро:** `C# (.NET 8)`.
- **Веб-карта и интерфейсы ролей (командир/наблюдатель/логистика):** `TypeScript + React + MapLibre GL`.
- **HUD/оверлей для наводчика поверх игры:** `Electron + React` (или Tauri как облегчённая альтернатива).

### Почему именно так
- C# удобен для математических расчётов, многопоточности, строгой типизации и быстрого масштабирования realtime-логики.
- TypeScript + React даёт быстрый UI-цикл, типобезопасность и богатую экосистему карт и геоинструментов.
- Electron позволяет сделать закреплённое окно поверх игры (always-on-top), websocket-синхронизацию и быстрое прототипирование.

---

## 2) Веб-карта: на чём делать

**Базовый выбор:**
- `MapLibre GL JS` для 2D-карты + кастомные слои.
- `turf.js` для геометрии: зоны безопасности, шаблоны огня, буферы, пересечения, линейки.
- `React + Zustand/Redux` для состояния карты и боевых задач.

**Функции карты, которые этот стек покрывает:**
- Маркеры: орудия, батареи, наблюдатели, дроны, цели, логистика, мины.
- Режимы рисования: круги/сектора/полигоны безопасных зон, паттерны обстрела.
- Инструменты измерения: дистанция, азимут, серия точек, профиль маршрута.
- Калибровка карты: контрольные точки + affine/projective-преобразование.

---

## 3) Единая БД (карта, метки, координаты, миссии, статусы)

**Рекомендуемая база:** `PostgreSQL + PostGIS`.

### Что хранить централизованно
- Пользователи, роли, права доступа (RBAC).
- Геообъекты карты (точки/линии/полигоны) в PostGIS.
- Профили орудий и боеприпасов, баллистические таблицы, калибровки.
- Fire missions: постановка задачи, назначение орудий, статус выполнения.
- Журнал корректировок наблюдателя и ответы батареи.
- События телеметрии/статусов орудий (готов, стреляет, перезарядка, нужен БК).

### Что добавить рядом с БД
- `Redis` для realtime-кэша/очередей событий.
- `NATS` или `RabbitMQ` для событийной шины (назначения, подтверждения, корректировки).

---

## 4) HUD поверх игры

**Цель:** отдельное окно наводчика/наблюдателя поверх Arma Reforger.

### Для наводчика (HUD Gunner)
- Входящие команды: цель, азимут, угол, тип БК, темп/серия.
- Кнопки статуса: "готов", "веду огонь", "нужен БК", "орудие повреждено".
- Быстрая отправка подтверждения и ошибок наведения.

### Для наблюдателя (HUD Observer)
- Форма корректировки: недолёт/перелёт, левее/правее, повтор/завершить.
- Привязка к конкретной миссии и орудию/батарее.
- Мгновенная отправка корректировок в назначенный канал.

### Транспорт
- WebSocket (SignalR в .NET) для событий <100–300 мс внутри локальной сети/сервера.

---

## 5) Рекомендуемая серверная схема

- `api-gateway` (REST + auth)
- `realtime-hub` (SignalR/WebSocket)
- `ballistics-core` (расчёты, таблицы, метео-поправки)
- `mission-service` (огневые задачи, назначение батарей)
- `map-service` (слои карты, геообъекты, калибровка)
- `telemetry-service` (статусы расчётов и техники)

Все сервисы используют одну PostgreSQL/PostGIS (с разграничением схем) + Redis + message bus.

---

## 6) Минимальные технологии по блокам

- **Auth/RBAC:** Keycloak или Auth0 + JWT.
- **Backend API:** ASP.NET Core Web API.
- **Realtime:** SignalR.
- **Frontend web:** React + Vite + TypeScript.
- **Map:** MapLibre GL + turf.js.
- **Overlay/HUD:** Electron + React.
- **DB:** PostgreSQL 16 + PostGIS.
- **Infra:** Docker Compose (MVP), затем Kubernetes.

---

## 7) Практический итог: что выбрать прямо сейчас

Если нужно быстро и надёжно стартовать:
1. **Язык:** C# (.NET 8) + TypeScript.
2. **Карта:** React + MapLibre + turf.js.
3. **Единая БД:** PostgreSQL + PostGIS.
4. **HUD поверх игры:** Electron + WebSocket (SignalR).
5. **Realtime обмен ролей:** SignalR + Redis backplane.

Это даёт лучший баланс между скоростью разработки, точностью расчётов, стабильностью и дальнейшим масштабированием до сложных огневых сценариев.
